<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Computer Parts Inventory</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 text-gray-900 transition-colors duration-300">

  <!-- Navbar -->
  <nav class="flex justify-between items-center p-4 bg-indigo-600 text-white shadow">
    <h1 class="text-xl font-bold">ğŸ’» Computer Parts Inventory</h1>
    <div class="flex items-center gap-4">
      <input id="searchInput" type="text" placeholder="ğŸ” Search..."
        class="px-3 py-1 rounded-md text-gray-800 focus:outline-none" />
      <button id="themeToggle" class="px-3 py-1 rounded-md bg-indigo-800 hover:bg-indigo-900 transition">
        ğŸŒ™
      </button>
    </div>
  </nav>

  <!-- Main -->
  <main class="max-w-4xl mx-auto p-6">
    <!-- Form -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6 mb-8 transition">
      <h2 class="text-2xl font-bold mb-4 text-indigo-700 dark:text-indigo-300">Add / Edit Part</h2>

      <form id="partForm" class="grid md:grid-cols-2 gap-4">
        <input type="text" name="type" placeholder="Type (GPU, CPU)" required class="input">
        <input type="text" name="brand" placeholder="Brand" required class="input">
        <input type="text" name="model" placeholder="Model" required class="input">
        <input type="number" name="quantity" placeholder="Quantity" required class="input">
        <input type="number" name="price" placeholder="Price (USD)" step="0.01" required class="input md:col-span-2">
        <button type="submit" class="btn bg-indigo-600 hover:bg-indigo-700 md:col-span-2">ğŸ’¾ Save</button>
      </form>

      <p id="message" class="text-center mt-3 font-medium"></p>
    </div>

    <!-- Parts List -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6 transition">
      <h2 class="text-2xl font-bold mb-4 text-indigo-700 dark:text-indigo-300">ğŸ“‹ Parts List</h2>
      <div id="partsList" class="grid gap-4"></div>
    </div>
  </main>

  <script>
    const form = document.getElementById("partForm");
    const message = document.getElementById("message");
    const partsList = document.getElementById("partsList");
    const searchInput = document.getElementById("searchInput");
    const themeToggle = document.getElementById("themeToggle");

    let editId = null;
    let allParts = [];

    // Tailwind helper classes
    const inputStyle = "input";
    const btnStyle = "btn";

    // Load parts
    async function loadParts() {
      const res = await fetch("/parts");
      allParts = await res.json();
      displayParts(allParts);
    }

    // Display parts
    function displayParts(parts) {
      partsList.innerHTML = parts.length ? parts.map(p => `
        <div class="flex justify-between items-center bg-gray-50 dark:bg-gray-700 p-4 rounded-lg shadow-sm hover:shadow-md transition">
          <div>
            <p class="font-bold">${p.type}</p>
            <p class="text-sm text-gray-600 dark:text-gray-300">${p.brand} - ${p.model}</p>
            <p class="text-sm text-gray-500">Qty: ${p.quantity} | ğŸ’²${p.price}</p>
          </div>
          <div class="flex gap-2">
            <button onclick="editPart('${p._id}')" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">âœï¸ Edit</button>
            <button onclick="deletePart('${p._id}')" class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600">ğŸ—‘ï¸ Delete</button>
          </div>
        </div>
      `).join("") : `<p class="text-center text-gray-500">No parts found.</p>`;
    }

    // Submit new or edited part
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form).entries());

      try {
        let res;
        if (editId) {
          res = await fetch(`/parts/${editId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });
          message.textContent = "âœ… Part updated!";
        } else {
          res = await fetch("/submit", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });
          message.textContent = "âœ… Part added!";
        }
        message.className = "text-green-600 text-center mt-2";
        form.reset();
        editId = null;
        await loadParts();
      } catch {
        message.textContent = "âŒ Error submitting data";
        message.className = "text-red-600 text-center mt-2";
      }
    });

    // Edit part
    window.editPart = (id) => {
      const part = allParts.find(p => p._id === id);
      if (!part) return;
      Object.entries(part).forEach(([key, value]) => {
        if (form.elements[key]) form.elements[key].value = value;
      });
      editId = id;
      message.textContent = "âœï¸ Editing mode...";
      message.className = "text-blue-600 text-center mt-2";
    };

    // Delete part
    window.deletePart = async (id) => {
      if (!confirm("Are you sure you want to delete this part?")) return;
      await fetch(`/parts/${id}`, { method: "DELETE" });
      message.textContent = "ğŸ—‘ï¸ Part deleted!";
      message.className = "text-red-600 text-center mt-2";
      loadParts();
    };

    // Search filter
    searchInput.addEventListener("input", () => {
      const q = searchInput.value.toLowerCase();
      const filtered = allParts.filter(p =>
        p.type.toLowerCase().includes(q) ||
        p.brand.toLowerCase().includes(q) ||
        p.model.toLowerCase().includes(q)
      );
      displayParts(filtered);
    });

    // Dark mode toggle
    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark");
      themeToggle.textContent = document.body.classList.contains("dark") ? "â˜€ï¸" : "ğŸŒ™";
    });

    loadParts();
  </script>

  <style>
    .input {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 0.6rem;
      width: 100%;
      transition: all 0.2s;
    }
    .input:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 2px #c7d2fe;
    }
    .btn {
      color: #fff;
      padding: 0.6rem;
      border-radius: 8px;
      font-weight: 600;
      width: 100%;
    }
    .dark {
      background-color: #1f2937;
      color: #f9fafb;
    }
  </style>

</body>
</html>
